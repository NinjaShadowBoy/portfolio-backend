# ===============================================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# ===============================================================
# This file contains production-specific overrides for application.properties
# Activate with: SPRING_PROFILES_ACTIVE=prod
# ===============================================================

# ======================
# DATABASE CONFIG
# ======================
# Production database - MUST use environment variables
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWORD}

# Optimized connection pool for production
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# ======================
# JPA/HIBERNATE - PRODUCTION
# ======================
# CRITICAL: Never auto-create/update tables in production!
# Use 'validate' to verify schema matches entities without changing DB
spring.jpa.hibernate.ddl-auto=validate

# Disable SQL logging in production for performance
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# Performance optimizations
spring.jpa.properties.hibernate.jdbc.batch_size=30
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.open-in-view=false

# ======================
# SECURITY - PRODUCTION
# ======================
# CRITICAL: Remove default admin credentials in production
# These should be commented out or removed entirely
# DO NOT use default credentials in production!
spring.security.user.name=${ADMIN_USERNAME:}
spring.security.user.password=${ADMIN_PASSWORD:}

# JWT Configuration - MUST use secure environment variables
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:3600000}
jwt.issuer=${JWT_ISSUER:NinjaShadowBoy-PortfolioApp}

# ======================
# OAUTH2 - PRODUCTION
# ======================
app.oauth2.redirect-uri=${OAUTH2_REDIRECT_URI}

# OAuth2 Base URL for production
spring.security.oauth2.client.registration.google.redirect-uri=${OAUTH2_BASE_URL}/login/oauth2/code/google
spring.security.oauth2.client.registration.github.redirect-uri=${OAUTH2_BASE_URL}/login/oauth2/code/github
spring.security.oauth2.client.registration.facebook.redirect-uri=${OAUTH2_BASE_URL}/login/oauth2/code/facebook

# ======================
# FILE UPLOAD - PRODUCTION
# ======================
# Use absolute paths in production
profile-photo.upload.dir=${PROFILE_PHOTO_UPLOAD_DIR:/var/www/uploads/profilephoto}
photo.upload.dir=${PHOTO_UPLOAD_DIR:/var/www/uploads/photos}

# Production file size limits (consider CDN for larger files)
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=15MB

# ======================
# STATIC RESOURCES - PRODUCTION
# ======================
# Enable aggressive caching for static resources (7 days)
spring.web.resources.cache.period=604800

# Enable compression
spring.web.resources.chain.compressed=true
spring.web.resources.chain.enabled=true
spring.web.resources.chain.strategy.content.enabled=true

# ======================
# LOGGING - PRODUCTION
# ======================
# Production logging - less verbose, file-based
logging.level.root=WARN
logging.level.com.ninjashadowboy.portfolio=INFO
logging.level.org.springframework.web=WARN
logging.level.org.springframework.security=WARN
logging.level.org.hibernate=WARN
logging.level.org.hibernate.SQL=ERROR

# File logging for production
logging.file.name=${LOG_FILE_PATH:/var/log/portfolio/application.log}
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=30
logging.logback.rollingpolicy.total-size-cap=1GB
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} %-5level [%thread] %logger{35} - %msg%n

# ======================
# EMAIL - PRODUCTION
# ======================
# Use environment variables for SMTP credentials
spring.mail.username=${SMTP_USERNAME}
spring.mail.password=${SMTP_PASSWORD}
spring.mail.host=${SMTP_HOST:smtp.gmail.com}
spring.mail.port=${SMTP_PORT:587}

# Email sending enabled in production
email.sending.enabled=true

# ======================
# API DOCUMENTATION
# ======================
# Consider disabling Swagger in production for security
# Or restrict access to authenticated admin users only
springdoc.api-docs.enabled=${SWAGGER_ENABLED:false}
springdoc.swagger-ui.enabled=${SWAGGER_ENABLED:false}

# If you keep Swagger enabled, ensure it's behind authentication
# springdoc.api-docs.enabled=true
# springdoc.swagger-ui.enabled=true

# ======================
# ACTUATOR - PRODUCTION
# ======================
# Restrict actuator endpoints in production
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=never

# Secure actuator endpoints
management.server.port=${MANAGEMENT_PORT:8081}
management.endpoints.web.base-path=/actuator

# ======================
# DEV TOOLS
# ======================
# CRITICAL: Disable development tools in production
spring.devtools.restart.enabled=false
spring.devtools.livereload.enabled=false

# ======================
# CACHING - PRODUCTION
# ======================
# Enhanced caching for production
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=1000,expireAfterAccess=300s

# ======================
# ERROR HANDLING
# ======================
# Don't expose error details in production
server.error.include-message=never
server.error.include-binding-errors=never
server.error.include-stacktrace=never
server.error.include-exception=false

# ======================
# SESSION MANAGEMENT
# ======================
# Session timeout (30 minutes)
server.servlet.session.timeout=30m
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.same-site=strict

# ======================
# CORS (if needed)
# ======================
# Configure CORS for your production frontend domain
# This should be configured in your SecurityConfig class
# Example: https://yourfrontend.com

# ======================
# SSL/TLS (if terminating SSL at app level)
# ======================
# Usually handled by reverse proxy (nginx, CloudFlare, etc.)
# Uncomment if you're handling SSL in Spring Boot
# server.ssl.enabled=true
# server.ssl.key-store=${SSL_KEYSTORE_PATH}
# server.ssl.key-store-password=${SSL_KEYSTORE_PASSWORD}
# server.ssl.key-store-type=PKCS12
# server.ssl.key-alias=tomcat

# ======================
# COMPRESSION
# ======================
# Enable response compression
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,application/xml
server.compression.min-response-size=1024

# ======================
# THREAD POOL
# ======================
# Tomcat thread pool configuration
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.max-connections=10000
server.tomcat.accept-count=100
